{% extends "layouts/main.html" %}

{% block header %}
{% include "layouts/shared/header.html" %}
{% endblock %}

{% set pageName="Completed tasks" %}

{% block content %}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        <h1 class="govuk-heading-xl">
            Completed tasks
        </h1>
    </div>
</div>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-one-quarter govuk-!-padding-0">
        <noscript>
            <p>
                Please enable javascript for sorting and filtering.
            </p>
        </noscript>
        <div class="ccs-filters-intro govuk-!-padding-1">
            <a class="ccs-clear-filters" aria-label="Clear filters" href="/tasks/history">Clear filters</a>
            <h2 class="govuk-heading-m">Apply filters</h2>
        </div>
        <div class="ccs-accordion ccs-accordion--clean" data-module="govuk-accordion"
            id="accordion-with-summary-sections">
            <div class="govuk-accordion__controls"><button type="button" class="govuk-accordion__open-all"
                    aria-expanded="false">Open all<span class="govuk-visually-hidden"> sections</span></button></div>
            <div
                class="govuk-accordion__section ccs-accordion__section--clean govuk-form-group govuk-form-group--enclosure ccs-form-group--enclosure--tight">
                <div class="govuk-accordion__section-header">
                    <h2 class="govuk-accordion__section-heading">

                        <button type="button" id="accordion-with-summary-sections-heading-1"
                            aria-controls="accordion-with-summary-sections-content-1"
                            class="govuk-accordion__section-button ccs-accordion__section-button" aria-expanded="false">
                            <h3 class="govuk-heading-s">
                                Agreement
                            </h3>
                            <span class="govuk-accordion__icon" aria-hidden="true"></span>
                        </button>
                    </h2>
                </div>
                <div aria-labelledby="accordion-with-summary-sections-heading-1"
                    class="govuk-accordion__section-content" id="accordion-with-summary-sections-content-1">
                    <div class="govuk-form-group">
                        <fieldset class="govuk-fieldset">
                            <legend class="govuk-fieldset__legend govuk-fieldset__legend--m"></legend>
                            <div class="govuk-checkboxes govuk-checkboxes--small ccs-checkboxes--scrollable">
                                {% set uniqueAgreements = [] %}
                                {% for task in data %}
                                    {% if uniqueAgreements.indexOf(task.framework_id) === -1 %}
                                        <div class="govuk-checkboxes__item">
                                            <input type="checkbox" name="framework_id[]"
                                                id="framework_id_{{task.framework_id}}"
                                                value="{{task.framework_id}}" class="govuk-checkboxes__input">
                                            <label class="govuk-checkboxes__label"
                                                for="framework_id_{{task.framework_id}}"> {{ task.title }} </label>
                                        </div>
                                        {% set _ = uniqueAgreements.push(task.framework_id) %}
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>
        <div class="ccs-accordion ccs-accordion--clean" data-module="govuk-accordion"
            id="accordion-with-summary-sections">
            <div class="govuk-accordion__controls"><button type="button" class="govuk-accordion__open-all"
                    aria-expanded="false">Open all<span class="govuk-visually-hidden"> sections</span></button></div>
            <div
                class="govuk-accordion__section ccs-accordion__section--clean govuk-form-group govuk-form-group--enclosure ccs-form-group--enclosure--tight">
                <div class="govuk-accordion__section-header">
                    <h2 class="govuk-accordion__section-heading">

                        <button type="button" id="accordion-with-summary-sections-heading-1"
                            aria-controls="accordion-with-summary-sections-content-1"
                            class="govuk-accordion__section-button ccs-accordion__section-button" aria-expanded="false">
                            <h3 class="govuk-heading-s">
                                Task Period
                            </h3>
                            <span class="govuk-accordion__icon" aria-hidden="true"></span>
                        </button>
                    </h2>
                </div>
                <div aria-labelledby="accordion-with-summary-sections-heading-1"
                    class="govuk-accordion__section-content" id="accordion-with-summary-sections-content-1">
                    <div class="govuk-form-group">
                        <fieldset class="govuk-fieldset">
                            <legend class="govuk-fieldset__legend govuk-fieldset__legend--l govuk-!-margin-bottom-1">
                                <h3 class="govuk-heading-s govuk-!-margin-bottom-1">
                                    From
                                </h3>
                            </legend>
                            <div class="govuk-date-input" id="from-date">
                                <div class="govuk-date-input__item">
                                    <div class="govuk-form-group">
                                        <label class="govuk-label govuk-date-input__label" for="month_from">
                                            Month
                                        </label>
                                        <select name="month_from" id="month_from" class="govuk-select"
                                            aria-label="Month From">
                                            <option value="1">Jan</option>
                                            <option selected="selected" value="2">Feb</option>
                                            <option value="3">Mar</option>
                                            <option value="4">Apr</option>
                                            <option value="5">May</option>
                                            <option value="6">Jun</option>
                                            <option value="7">Jul</option>
                                            <option value="8">Aug</option>
                                            <option value="9">Sep</option>
                                            <option value="10">Oct</option>
                                            <option value="11">Nov</option>
                                            <option value="12">Dec</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="govuk-date-input__item">
                                    <div class="govuk-form-group">
                                        <label class="govuk-label govuk-date-input__label" for="year_from">
                                            Year
                                        </label>
                                        <select name="year_from" id="year_from" class="govuk-select"
                                            aria-label="Year From">
                                            <option selected="selected" value="2010">2010</option>
                                            <option value="2018">2018</option>
                                            <option value="2019">2019</option>
                                            <option value="2020">2020</option>
                                            <option value="2021">2021</option>
                                            <option value="2022">2022</option>
                                            <option value="2023">2023</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    <div class="govuk-form-group">
                        <fieldset class="govuk-fieldset">
                            <legend class="govuk-fieldset__legend govuk-fieldset__legend--l govuk-!-margin-bottom-1">
                                <h3 class="govuk-heading-s govuk-!-margin-bottom-1">
                                    To
                                </h3>
                            </legend>
                            <div class="govuk-date-input" id="to-date">
                                <div class="govuk-date-input__item">
                                    <div class="govuk-form-group">
                                        <label class="govuk-label govuk-date-input__label" for="month_to">
                                            Month
                                        </label>
                                        <select name="month_to" id="month_to" class="govuk-select"
                                            aria-label="Month To">
                                            <option value="1">Jan</option>
                                            <option value="2">Feb</option>
                                            <option value="3">Mar</option>
                                            <option value="4">Apr</option>
                                            <option value="5">May</option>
                                            <option value="6">Jun</option>
                                            <option value="7">Jul</option>
                                            <option selected="selected" value="8">Aug</option>
                                            <option value="9">Sep</option>
                                            <option value="10">Oct</option>
                                            <option value="11">Nov</option>
                                            <option value="12">Dec</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="govuk-date-input__item">
                                    <div class="govuk-form-group">
                                        <label class="govuk-label govuk-date-input__label" for="year_to">
                                            Year
                                        </label>
                                        <select name="year_to" id="year_to" class="govuk-select" aria-label="Year To">
                                            <option value="2010">2010</option>
                                            <option value="2018">2018</option>
                                            <option value="2019">2019</option>
                                            <option value="2020">2020</option>
                                            <option value="2021">2021</option>
                                            <option value="2022">2022</option>
                                            <option selected="selected" value="2023">2023</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="govuk-grid-column-three-quarters">
        <p>
            Sort by &nbsp;
            <select name="order_by" id="order-by" class="govuk-select" aria-label="Sort by month">
                <option value="Month (newest)">Month (newest)</option>
                <option value="Month (oldest)">Month (oldest)</option>
            </select>
        </p>
        <div class="results" id="completed-tasks-table">
            <table class="govuk-table">
                <caption class="govuk-table__caption govuk-visually-hidden">
                    List of previously completed tasks
                </caption>
                <thead class="govuk-table__head">
                    <tr class="govuk-table__row">
                        <th class="govuk-table__header govuk-!-width-one-third">Agreement</th>
                        <th class="govuk-table__header" scope="col">
                            Supplier
                        </th>
                        <th class="govuk-table__header" scope="col">Month</th>
                        <th class="govuk-table__header" scope="col">Reported value</th>
                        <th class="govuk-table__header" scope="col">Completed at</th>
                        <th class="govuk-table__header" scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody class="govuk-table__body">
                    {% for task in data %}
                    <tr class="govuk-table__row">
                        <th class="govuk-table__header ccs-report-table__cell" scope="row">
                            {{ task.title }}
                        </th>
                        <td class="govuk-table__cell ccs-report-table__cell">
                            {{ task['supplier']['name'] }}
                        </td>
                        <td class="govuk-table__cell ccs-report-table__cell">
                            {{ task.month }}
                        </td>
                        <td class="govuk-table__cell ccs-report-table__cell">
                            No business
                        </td>
                        <td class="govuk-table__cell ccs-report-table__cell">
                            {{ task.updated_at }}
                        </td>
                        <td class="govuk-table__cell ccs-report-table__cell">
                            <a aria-label="View submission on RM6268 for August 2023"
                                href="/tasks/1ec0a337-4622-4d9b-aea3-134097d75a45">View</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <nav aria-label="Pagination" class="pagination ccs-pagination" role="navigation">
                {% set itemCount = data.length %}
                {% if itemCount === 1 %}
                    <div class="ccs-pagination__summary"><p>Displaying <b>1</b> task</p></div>
                {% elif itemCount > 1 %}
                    <div class="ccs-pagination__summary"><p>Displaying all <b>{{ itemCount }}</b> tasks</p></div>
                {% else %}
                    <div class="ccs-pagination__summary"><p>No tasks found</p></div>
                {% endif %}
            </nav>
        </div>
    </div>
</div>

{% endblock %}